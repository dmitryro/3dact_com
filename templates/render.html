{% extends "base_raphael.html" %}
{% block content %}
<h4>Render Content</h4>
 <nav class="navbar navbar-default navbar-fixed-bottom" role="navigation">
    <span style="float: left">Stroke Color: <br><input type="color" id="strokeColorPicker" value="#000000"></span>
    <span style="float: left">Fill Color: <br><input type="color" id="fillColorPicker" value="#000000" onclick="changePalette();"></span>
    <span style="float: left; margin: 30px 5px">Stroke Width: <input type="number" id="strokeWidthPicker" value="5" min="1" max="256"></span>
    <div class="btn-group" style="float: left; margin: 30px 5px">
      <button type="button" class="btn btn-default clear">Clear All</button>
      <button type="button" class="btn btn-default undo">Undo</button>
      <button type="button" id="save-btn" class="btn btn-default undo">Save</button>   
    </div>
    <form style="margin: 20px 5px">
      <input type="radio" name="tool" value="pathTool">Path Tool<br>
      <input type="radio" name="tool" value="shapeTool">Shape Tool<small style="opacity:0.5">beta</small>
    <div style="position:relative; bottom: 15px; right: 15px" class="btn-group pull-right">
      <button  id="fadeMenu" type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#formModal">
        Aribitrary form
      </button>
    </div> 
    </form>
  </nav>  

  <!-- Modal -->
  <div id="canvas_container" style="border:1px black solid;height:600px;width:800px;margin-left:1%;margin-right:-200px;">
            <svg height="400" width="600">
            </svg>
            <canvas id="cvs" width="600px" height="400px" style="display:none;"></canvas>

  </div>
  <div class="modal fade" id="formModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title" id="myModalLabel">Random Modal Form</h4>
        </div>
        <div class="modal-body">
          <form role="form"> 
            <div class="form-group"> 
              <label for="randomTitle">Title:</label>
              <input type="text" class="form-control" id="randomTitle">
            </div>
            <div class="form-group"> 
              <label for="randomArtist">Artist:</label>
              <input type="text" class="form-control" id="RandomArtist">
            </div>
            <div class="form-group"> 
              <label for="randomDescription">Description:</label>
              <input type="text" class="form-control" id="RandomDescription">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">Save changes</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
   <div id="save">
        <p>
            <button id="save">save</button> or <button id="convert">convert to</button> as: 
            <select id="sel">
                <option value="png">png</option>
                <option value="jpeg">jpeg</option>
                <option value="bmp">bmp</option>
            </select><br/>
            width : <input type="number" value="300" id="imgW" /><br/>
            height : <input type="number" value="200" id="imgH" />
        </p>

    </div>
  <div id="imgs">
        
  </div>
<script>
    var canvas, ctx, bMouseIsDown = false, iLastX, iLastY,
        $save, $imgs,
        $convert, $imgW, $imgH,
        $sel;

    function init () {
        var svg = $( "svg" ).first();

        var canv = $("canvas").first();
        importSVG(svg, canvas)

        $save = document.getElementById('save');
        $convert = document.getElementById('convert');
        $sel = document.getElementById('sel');
        $imgs = document.getElementById('imgs');
        $imgW = document.getElementById('imgW');
        $imgH = document.getElementById('imgH');
        bind();
        //draw();
    }

    function bind () {
        var canvas = $("canvas").first(); 
        canvas.onmousedown = function(e) {
            bMouseIsDown = true;
            iLastX = e.clientX - canvas.offsetLeft + (window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft);
            iLastY = e.clientY - canvas.offsetTop + (window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop);
        }
        canvas.onmouseup = function() {
            bMouseIsDown = false;
            iLastX = -1;
            iLastY = -1;
        }
        canvas.onmousemove = function(e) {
            if (bMouseIsDown) {
                var iX = e.clientX - canvas.offsetLeft + (window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft);
                var iY = e.clientY - canvas.offsetTop + (window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop);
                ctx.moveTo(iLastX, iLastY);
                ctx.lineTo(iX, iY);
                ctx.stroke();
                iLastX = iX;
                iLastY = iY;
            }
        };
        
        $save.onclick = function (e) {
            var type = $sel.value,
                w = $imgW.value,
                h = $imgH.value;
            //Canvas2Image.saveAsImage(canvas, w, h, type);
        }
        $convert.onclick = function (e) {
            var type = $sel.value,
                w = $imgW.value,
                h = $imgH.value;
            $imgs.appendChild(saveSVG(w,h,type));            
       //     $imgs.appendChild(Canvas2Image.convertToImage(canvas, w, h, type));
        }
        
    }
    function draw () {
        var canvas = $("canvas").first(); 
        var ctx = canvas.getContext('2d');
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, 600, 400);
        ctx.fillStyle = 'red';
        ctx.fillRect(100, 100, 50, 50);
    }
    
    
    onload = init;
</script>
{% endblock %}

